#!/usr/bin/env python2.7
import os, sys
import getopt

import larp
import larp.larp_config as config
import larp.larp_usage as usage

from termcolor import colored

cfg_data = None
verbose = False

if os.geteuid() != 0:
    print >> sys.stderr, colored("[!] RUN THE PROGRAM AS ROOT!", "red")
    larp.usage()
    sys.exit(-1)

try:
    optlist, args = getopt.getopt(sys.argv[1:], "hvc",\
        ["help", "verbose", "confiure"])
except:
    print >> sys.stderr, colored("[!] YOU DID NOT PROVIDE THE GOOD NUMBER OF ARGUMENTS:\n%s" % str(getopt.GetoptError), 'red')
    usage.usage()
    sys.exit(-1)

for o, a in optlist:
    if o in ("-h", "--help"):
        usage()
        sys.exit(1)
    if o in ("-v", "--verbose"):
        verbose = True
    if o in ("-c", "--configure"):
        config.configure(verbose).gen_config_wiz()
    else:
        assert False, "Umhandled Option"

#-----------------------------------------

while cfg_data == None:
    cfg_data = config.configure(verbose).configure()
    if cfg_data == None:
        print colored("[!] CFG File Missing do you wish to generate one?", 'red')
        a = raw_input('[Y/n]')
        if a == 'Y' or a == 'y':
            config.configure(verbose).gen_config_wiz()
        else:
            sys.exit(-1)

if verbose:
    print "config -> ",
    print cfg_data

#----------------------------------------

larp.larp(cfg_data['GATEWAY'], cfg_data['INTERFACE'], cfg_data['IP_PATH'], verbose=verbose).main()
